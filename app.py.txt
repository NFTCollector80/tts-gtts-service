from flask import Flask, request, send_file
from gtts import gTTS
import os
import io

app = Flask(__name__)

@app.route('/tts', methods=['POST'])
def tts_service():
    # JSON verisinden metni al
    data = request.get_json()
    if not data or 'text' not in data:
        return {"error": "Metin bulunamadı."}, 400

    text = data['text']

    # gTTS kullanarak sesi oluştur
    tts = gTTS(text=text, lang='tr')
    
    # Sesi belleğe kaydet, dosya oluşturmadan
    audio_buffer = io.BytesIO()
    tts.write_to_fp(audio_buffer)
    audio_buffer.seek(0)

    # Ses dosyasını yanıt olarak gönder
    return send_file(audio_buffer, mimetype='audio/mpeg')

if __name__ == '__main__':
    # Gerekli portu dinle
    app.run(host='0.0.0.0', port=5000)